"use strict";(globalThis.webpackChunk_croquet_microverse=globalThis.webpackChunk_croquet_microverse||[]).push([[609],{6609:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});const s={modules:[{name:"Light",pawnBehaviors:[class LightPawn{setup(){console.log("LightPawn");var e=this.service("ThreeRenderManager"),t=e.scene,e=e.camera;let a=this.shape;this.removeLights(),this.setupCSM(t,e,Worldcore.THREE);t=new Worldcore.THREE.AmbientLight(16777215,.7),a.add(t),this.lights.push(t),this.constructBackground(this.actor._cardData),e=this._behavior.module.externalName;this.addUpdateRequest([e+"$LightPawn","update"]),this.listen("updateShape","updateShape")}removeLights(){this.lights&&this.lights.forEach(e=>{this.shape.remove(e)}),this.lights=[]}teardown(){console.log("teardown lights"),this.background&&this.background.dispose(),this.removeLights()}updateShape(e){this.constructBackground(e)}constructBackground(t){console.log("lights",t);let a=this.service("AssetManager").assetManager,s=t.dataType;var e=this.service("ThreeRenderManager");let i=e.renderer,o=e.scene;if(t.dataLocation)return this.getBuffer(t.dataLocation).then(e=>a.load(e,s,Worldcore.THREE,t).then(e=>{let t=new Worldcore.THREE.PMREMGenerator(i);t.compileEquirectangularShader();var a=t.fromEquirectangular(e).texture;let s=o.background,r=o.environment;o.background=a,o.environment=a,r!==s&&s&&s.dispose(),r&&r.dispose(),e.dispose()}));t.clearColor&&i.setClearColor(t.clearColor)}setupCSM(e,t,a){this.csm&&(this.csm.remove(),this.csm=null);var s=new a.Vector3(-200,-500,-200);this.csm=new a.CSM({fade:!0,far:t.far,maxFar:1e3,cascades:3,shadowMapSize:2048,shadowbias:25e-5,lightDirection:s,camera:t,parent:e,lightIntensity:.4,lightFar:1e3,mode:"practical"}),this.csm.update()}update(e){this.csm&&this.csm.update()}}]}]}}}]);